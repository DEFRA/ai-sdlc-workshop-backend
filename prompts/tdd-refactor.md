Now lets do step 3. REFACTOR: Improve while keeping tests green

Refactor this code to improve the readability and structure while keeping all tests green. Show me the refactored version and confirm tests still pass
